import angr
import networkx as nx
import matplotlib.pyplot as plt

def save_cfg(file_address, target_address="render/output.png"):
    project = angr.Project(file_address, load_options={"auto_load_libs": False})

    cfg = project.analyses.CFGEmulated(keep_state=True)

    graph = nx.DiGraph()

    for node in cfg.graph.nodes():
        graph.add_node(node.addr)
        for successor in cfg.graph.successors(node):
            graph.add_edge(node.addr, successor.addr)

    pos = nx.spring_layout(graph)

    nx.draw(graph, pos, with_labels=True, node_size=700, node_color="skyblue", font_size=8, font_color="black", font_weight="bold", arrowsize=10)

    plt.savefig(target_address, format="png")

    if __name__ == "__main__":
        print(graph)
        plt.show()


if __name__ == "__main__":
    file_address = "" # enter file address here
    cfg = save_cfg(file_address)
