const mongoose = require("mongoose");

const url = `mongodb://${ process.env.MONGODB_PORT || '127.0.0.1' }/malware`;

mongoose.connect(url);

const fileSchema = new mongoose.Schema({
    name: { type: String, required: true },
    type: String,
    size: Number,
    hashSHA256: { type: String, unique: true },
    // hashMD5: { type: String}
    // hashMD5: { type: String, unique: true }
});

const File = mongoose.model("File", fileSchema);

const graphSchema = new mongoose.Schema({
    name: { type: String, required: true },
    location: { type: String, default: "", unique: true }
});

const Graph = mongoose.model("Graph", graphSchema);

async function createFile(fileObject){
    try{
        const file  = await File.create(fileObject);
        await file.save();
        console.log("added malware to db");
    } catch (e){
        console.error(e);
    }
}

let file = {
    name: "Test",
    type: "test",
    size: 230,
    hashSHA256: "test1" 
}

async function createGraph (graphObject){
    try{
        const graph  = await Graph.create(graphObject);
        await graph.save();
        console.log("added graph to db");
    } catch (e){
        console.error(e);
    }
}

let graph = {
    name: "Test",
    location: "../"
}

// createGraph(graph);

async function searchGraph (searchObject){
    try{
        const graphs = await Graph.find(searchObject, { name: 1, location: 1 });
        return graphs;
    }
    catch (e){
        console.log("Error:", e.message);
    }
}

// searchGraphs({location: "./"})
//     .then((res) => {
//         console.log(res)
//     })

module.exports = {createFile, createGraph, searchGraph}